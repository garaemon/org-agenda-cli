# org-agenda-cli 機能分析とロードマップ

本書は、`org-agenda-cli` の現状を整理し、**Taskbook** や **Taskwarrior** といった包括的な CLI タスク管理ツールと比較したものです。競争力のある CLI & TUI 体験を実現するために不足している機能を特定し、AI ネイティブなインターフェースを提案します。

## 1. 現状 (org-agenda-cli)

- **コア機能**:
    - **データストア**: Emacs Org-mode ファイル。
    - **コマンド**: `agenda` (タイムライン), `todo list`, `todo add`, `todo done`。
    - **フィルタリング**: ステータス (`TODO`, `DONE`, `WAITING`) とシンプルなタグによるフィルタリング。
    - **スケジュール**: `SCHEDULED` と `DEADLINE` タイムスタンプをサポート。
    - **TUI**: Bubble Tea を使用した基本的な対話型リストビュー。
- **制限事項**:
    - リスト表示のみ (ボード/カンバン表示なし)。
    - 優先度管理 (`[#A]`, `[#B]`) が CLI で公開されていない。
    - `add` コマンドで繰り返しタスクのサポートがない。

## 2. 機能比較

| 機能 | `org-agenda-cli` | `taskbook` | `taskwarrior` |
| :--- | :--- | :--- | :--- |
| **ストレージ** | Org-mode (テキスト) | JSON | SQLite / テキスト |
| **ビュー** | リスト, アジェンダ | **ボード**, タイムライン | リスト, レポート, カレンダー |
| **整理** | ファイル, タグ | **ボード**, グループ | **プロジェクト**, タグ, UDAs |
| **優先度** | (Org内で暗黙的) | **1, 2, 3** | **H, M, L** |
| **依存関係** | なし | なし | **あり (ブロッカー)** |
| **メモ**| 専用CMDなし | **ファーストクラス `note`** | アノテーション機能 |
| **進捗**| なし | **ボード統計 (%)** | バーンダウンチャート |
| **属性** | ステータス, 日付 | スター, アーカイブ | **仮想タグ** |

## 3. 不足機能（ギャップ分析）

TUI と AI 連携を備えた「Taskbook/Taskwarrior ライク」な体験を実現するために、以下の機能が不足しています。

### A. コア CLI の改善
1.  **優先度のサポート**:
    - `todo add` に `--priority <A|B|C>` を追加。
    - `list` で優先度ごとの色分け表示。(Add `--no-color` option for plain text output)
2.  **メモ管理**:
    - `note add` または `todo note` を追加し、タスクや単独のメモにテキストを追加できるようにする。
3.  **プロジェクト/ボード構成 (タグベース)**:
    - ユーザーの決定により、特別な「プロジェクト階層」は実装せず、**タグ**を使用してプロジェクトやボードを表現します。
    - 既存の `--tags` オプションを活用し、必要に応じて TUI でタグごとのビューを提供します。
4.  **繰り返し**:
    - `todo add` に `--repeat <1w|1d>` を追加 (Org タイムスタンプに `+1w` を生成)。
5.  **スマート/仮想タグ**:
    - `todo list` で `--due today` や `--overdue` などのフィルタリングを可能にする。
6.  **統計/サマリー**:
    - 新しいコマンド `org-agenda stats`: 完了率やタグ/ステータスごとのタスク数を表示。

### B. TUI の強化
1.  **ボード/カンバンビュー**:
    - マルチカラムの TUI ビュー (TODO | DOING | DONE) または (Project A | Project B)。
2.  **クイックアクション**:
    - 優先度の変更、日付の変更、開始日の移動などを行うキーバインディング。
    - `t` でタスク/メモの切り替え。

### C. AI 連携 & MCP (新規要件)

AI エージェントのためのシンプルなコマンドラインインターフェースが必要です。

1.  **JSON 出力モード**:
    - すべてのコマンド (`list`, `agenda`, `tags`, `stats`) が LLM でのパースを容易にする `--json` をサポートすること。
    - 現状の `todo list` はテキスト出力または TUI を前提としている。
2.  **コンテキストダンプ**:
    - `org-agenda dump --context <day|week>`: AI プランニング用に最小化されたタスクコンテキストを出力。
3.  **MCP サーバーインターフェース**:
    - 以下のリソースとツールを公開する Model Context Protocol サーバーを実装する:
        - **リソース**: `org://agenda/today`, `org://tasks/all`。
        - **ツール**: `add_task`, `list_tasks`, `mark_done`, `read_agenda`。

## 4. 提案ロードマップ

1.  **フェーズ 1: CLI の同等性**: `--priority`, `--json` 出力, `stats` コマンドを追加。
2.  **フェーズ 2: TUI のアップグレード**: カンバンボードビューの実装。
3.  **フェーズ 3: AI インターフェース**: `--json` の厳密な実装と MCP サーバーの実装。

## 5. 次のステップ
- `todo add --priority` の実装。
- グローバルな `--json` フラグサポートの実装。
- `MCP` サーバーインターフェース構造の定義。
